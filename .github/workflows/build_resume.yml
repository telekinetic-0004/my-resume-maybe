name: Build and Deploy Resume

on:
  push:
    branches: [ "main" ]

permissions:
  contents: write

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Get your code
      - name: Checkout Repository
        uses: actions/checkout@v3

      # Step 2: Compile the LaTeX into a PDF
      - name: Compile LaTeX
        uses: xu-cheng/latex-action@v3
        with:
          root_file: resume.tex

      # Step 3: Rename PDF and Update HTML
      - name: Process Files for Deployment
        run: |
          # 1. Generate the timestamp (e.g., 21-Nov-2025_18-30-05)
          TIMESTAMP=$(TZ='Asia/Kolkata' date +'%d-%b-%Y_%H-%M-%S')
          
          # 2. Define the new filename
          NEW_FILENAME="Resume-of-JSC_${TIMESTAMP}.pdf"
          echo "Generated filename: $NEW_FILENAME"

          # 3. Move the compiled PDF (from root) into the public folder
          # We rename it during the move
          mv resume.pdf "public/$NEW_FILENAME"

          # 4. Update the EXISTING index.html inside public/
          # This replaces all instances of 'resume.pdf' with the new timestamped name
          sed -i "s|resume.pdf|$NEW_FILENAME|g" public/index.html

      # Step 4: Deploy
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
